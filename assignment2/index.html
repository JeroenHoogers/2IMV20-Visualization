<!DOCTYPE html>
<html>
	<head>
		<title>Vizualization assignment 2</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<body>
		<div id="map-container"></div>
		<!-- <script src="//d3js.org/d3.v3.min.js"></script> -->
		<!-- <script src="//d3js.org/topojson.v0.min.js"></script> --> 
		<script src="js/d3.v3.min.js"></script>
		<script src="js/topojson.v0.min.js"></script>
		<script src="js/dataloader.js"></script>
		<script>

		// var width = 960, height = 500;

		var selected;
		var hover;

	    var map;

	    // load data
	    loaddata();

		function clicked(d) 
		{
			if (d && selected !== d) 
				selected = d;
			else 
				selected = null;

			map.selectAll("path")
				.classed("active", function(d) { return d === selected; });

		}


		function mouseenter(d) 
		{
			hover = d;
			map.selectAll("path")
				.classed("hover", function(d) { return d === hover; });
				
		}

		function mouseexit(d) 
		{
			hover = null;
			map.selectAll("path")
				.classed("hover", function(d) { return d === hover; });	
		}


		// d3.queue()
		//     .defer(d3.json, "data/world-110m2.json", loadWorld)
		//     .defer(d3.csv, "data/country-codes.csv", function(d) { 
		//     	countryMap.set(parseInt(d['M49']), {"name": d['name'], "code": d['ISO3166-1-Alpha-3']})
		//     })
		//     .await(ready);


		// function loadWorld(topology)
		// {
		// 	map.attr("id", "world")
		//     		.selectAll("path")
		// 	      	.data(topojson.object(topology, topology.objects.countries)
		// 	          .geometries)
		// 	    .enter()
		// 	      	.append("path")
		// 	      	.attr("d", path)
		// 	      	.on("click", clicked)
		// 	      	.on("mouseenter", mouseenter)
		// 	      	.on("mouseleave", mouseexit);
		// }

		function draw(height)
		{
			$("#map-container").html("<svg id='map' xmlns='http://www.w3.org/2000/svg' width='100%' height='" + height + "'></svg>");
		    map = d3.select("svg");
		    var width = $("svg").parent().width();

		    projection = d3.geo.equirectangular().scale((width/620)*100).translate([width/2, height/2]);
		    var path = d3.geo.path().projection(projection);

			// // load and display the World
			d3.json("data/world-110m2.json", function(error, topology) {
			    map.attr("id", "world")
		    		.selectAll("path")
			      	.data(topojson.object(topology, topology.objects.countries)
			          .geometries)
			    .enter()
			      	.append("path")
			      	.attr("d", path)
			      	.on("click", clicked)
			      	.on("mouseenter", mouseenter)
			      	.on("mouseleave", mouseexit)
		      	.append("title")
  					.text(function(d) 
  					{ 
  						var tooltip =  ""; 
  						if(countryMap.has(d.id))
  						{
  							tooltip += countryMap.get(d.id).name;

  							var code = countryMap.get(d.id).code;

  							if(landDist.has(code))
  							{
  								tooltip += " Total 2015: " + landDist.get(code)['Total_Land_Sqkm']['2015'];
  								tooltip += ",  Forest 2015: " + landDist.get(code)['Forest_Land_Sqkm']['2015'];
  								tooltip += ",  Agriculture 2015: " + landDist.get(code)['Agriculture_Land_Sqkm']['2015'];
  							}
  						}

  						return tooltip;
  					});
			});

			// var projection = d3.geo.mercator()
			//     .center([0, 5 ])
			//     .scale(100)
			//     .rotate([0,0]);

			// var width = d3.select("mapContainer").width();
			// var height = d3.select("mapContainer").height();

			// var svg = d3.select("body").append("svg")
			//     .attr("width", width)
			//     .attr("height", height);

			// var path = d3.geo.path()
			//     .projection(projection);

			// var g = svg.append("g");

			// // load and display the World
			// d3.json("data/world-110m2.json", function(error, topology) {
			//     g.selectAll("path")
			//       .data(topojson.object(topology, topology.objects.countries)
			//           .geometries)
			//     .enter()
			//       .append("path")
			//       .attr("d", path)
			// });
		}

		$(window).resize(function() {
		    if(this.resizeTO) clearTimeout(this.resizeTO);
		    this.resizeTO = setTimeout(function() {
		        $(this).trigger('resizeEnd');
		    }, 500);
		});

		$(window).bind('resizeEnd', function() {
		    var height = $("#map-container").width()/2;
		    $("#map-container svg").css("height", height);
		    draw(height);
		});

		draw($("#map-container").width()/2);
		</script>

	</body>
</html>
