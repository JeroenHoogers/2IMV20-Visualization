<!DOCTYPE html>
<html>
	<head>
		<title>Vizualization assignment 2</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<body>
		<div class="page">
			<div class="header">
				2IMV20 Visualization
			</div>
			<div class="content">
				<div class="side-left">
					Legend
					<div id="summary"></div>
				</div>
				<div class="main-content">
					<div id="map"></div>
				</div>
				<div class="timeline-container">
					<div id="timeline">
						
					</div>
				</div>
			</div>

		</div>

		<script src="js/d3.v3.min.js"></script>
		<script src="js/topojson.v0.min.js"></script>
		<script src="js/dataloader.js"></script>
		<script src="js/timeline.js"></script>
		<script>

		var width = 900, height = 600;

		var selected;
		var hover;

	    // load data
	    loaddata();



		// d3.queue()
		//     .defer(d3.json, "data/world-110m2.json", loadWorld)
		//     .defer(d3.csv, "data/country-codes.csv", function(d) { 
		//     	countryMap.set(parseInt(d['M49']), {"name": d['name'], "code": d['ISO3166-1-Alpha-3']})
		//     })
		//     .await(ready);


		// function loadWorld(topology)
		// {
		// 	map.attr("id", "world")
		//     		.selectAll("path")
		// 	      	.data(topojson.object(topology, topology.objects.countries)
		// 	          .geometries)
		// 	    .enter()
		// 	      	.append("path")
		// 	      	.attr("d", path)
		// 	      	.on("click", clicked)
		// 	      	.on("mouseenter", mouseenter)
		// 	      	.on("mouseleave", mouseexit);
		// }

		// Create summary svg
		var summary = d3.select("#summary").append("svg").attr({			
			"width": 275,
			"height": 400
		});

		// Create map svg
		var map = d3.select("#map").append("svg").attr({			
			"width": width,
			"height": height
		});

		// var width = 800;
		// var height = 600;

	 	var projection = d3.geo.mercator()
		      .scale((width + 1) / 2 / Math.PI)
		      .translate([width / 2, height / 1.6])
		      .precision(.5);

	    var path = d3.geo.path().projection(projection);

	    // Load & fill worldmap
		d3.json("data/world-topo-min.json", function(error, topology) {
		    map.attr("id", "world")
	    		.selectAll("path")
		      	.data(topojson.object(topology, topology.objects.countries).geometries)
		    .enter()
		      	.append("path")
		      	.attr("d", path)
		      	.on("click", clicked)
		      	.on("mouseenter", mouseenter)
		      	.on("mouseleave", mouseexit)
		   		.style("fill", countryColor)
		      	.append("title")
  					.text(function(d) 
  					{ 
  						var tooltip =  ""; 
  						// if(countryMap.has(d.properties.name))
  						// {
  						var name = d.properties.name;
						tooltip += name;

						//var code = countryMap.get(d.properties.name).code;

						if(landDist.has(d.properties.name))
						{

							tooltip += " Total 2015: " + landDist.get(name)['Total_Land_Sqkm']['2015'];
							tooltip += ",  Forest 2015: " + landDist.get(name)['Forest_Land_Sqkm']['2015'];
							tooltip += ",  Agriculture 2015: " + landDist.get(name)['Agriculture_Land_Sqkm']['2015'];
						}
  						//}

  						return tooltip;
  					});
		});

  		function countryColor(d,i)
  		{
  			return landDist.has(d.properties.name) ? "#aaa" : "red";
  		}


		function clicked(d) 
		{
			if (d && selected !== d) 
				selected = d;
			else 
				selected = null;

			map.selectAll("path")
				.classed("active", function(d) { return d === selected; });

		}


		function mouseenter(d) 
		{
			hover = d;
			map.selectAll("path")
				.classed("hover", function(d) { return d === hover; });
				
		}

		function mouseexit(d) 
		{
			hover = null;
			map.selectAll("path")
				.classed("hover", function(d) { return d === hover; });	
		}

		// function draw(height)
		// {
			//$("#map-container").html("<svg id='map' xmlns='http://www.w3.org/2000/svg' width='100%' height='" + height + "'></svg>");
		    //map = d3.select("svg");
		    //var width = $("svg").parent().width();

		    //var projection = d3.geo.equirectangular().scale((width/620)*100).translate([width/2, height/2]);

		   
			// // load and display the World

			// });

			// var projection = d3.geo.mercator()
			//     .center([0, 5 ])
			//     .scale(100)
			//     .rotate([0,0]);

			// var width = d3.select("mapContainer").width();
			// var height = d3.select("mapContainer").height();

			// var svg = d3.select("body").append("svg")
			//     .attr("width", width)
			//     .attr("height", height);

			// var path = d3.geo.path()
			//     .projection(projection);

			// var g = svg.append("g");

			// // load and display the World
			// d3.json("data/world-110m2.json", function(error, topology) {
			//     g.selectAll("path")
			//       .data(topojson.object(topology, topology.objects.countries)
			//           .geometries)
			//     .enter()
			//       .append("path")
			//       .attr("d", path)
			// });
		//}

		// $(window).resize(function() {
		//     if(this.resizeTO) clearTimeout(this.resizeTO);
		//     this.resizeTO = setTimeout(function() {
		//         $(this).trigger('resizeEnd');
		//     }, 500);
		// });

		// $(window).bind('resizeEnd', function() {
		//     var height = $("#map-container").width()/2;
		//     $("#map-container svg").css("height", height);
		//     draw(height);
		// });

		// draw($("#map-container").width()/2);
		</script>

	</body>
</html>
