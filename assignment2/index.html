<!DOCTYPE html>
<html>
	<head>
		<title>Vizualization assignment 2</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<body>
		<div id="map-container"></div>
		<script src="//d3js.org/d3.v3.min.js"></script>
		<script src="//d3js.org/topojson.v0.min.js"></script>
		<script>

		// var width = 960, height = 500;

		var selected;
		var hover;

	    var map;

		function clicked(d) 
		{
			if (d && selected !== d) 
				selected = d;
			else 
				selected = null;

			map.selectAll("path")
				.classed("active", function(d) { return d === selected; });
		}


		function mouseenter(d) 
		{
			hover = d;
			map.selectAll("path")
				.classed("hover", function(d) { return d === hover; });
				
		}

		function mouseexit(d) 
		{
			hover = null;
			map.selectAll("path")
				.classed("hover", function(d) { return d === hover; });
				
		}


		function draw(height)
		{
			$("#map-container").html("<svg id='map' xmlns='http://www.w3.org/2000/svg' width='100%' height='" + height + "'></svg>");
		    map = d3.select("svg");
		    var width = $("svg").parent().width();

		    projection = d3.geo.equirectangular().scale((width/620)*100).translate([width/2, height/2]);
		    var path = d3.geo.path().projection(projection);

			// load and display the World
			d3.json("data/world-110m2.json", function(error, topology) {
			    map.attr("id", "world")
		    		.selectAll("path")
			      	.data(topojson.object(topology, topology.objects.countries)
			          .geometries)
			    .enter()
			      	.append("path")
			      	.attr("d", path)
			      	.on("click", clicked)
			      	.on("mouseenter", mouseenter)
			      	.on("mouseleave", mouseexit)
			});

			// var projection = d3.geo.mercator()
			//     .center([0, 5 ])
			//     .scale(100)
			//     .rotate([0,0]);

			// var width = d3.select("mapContainer").width();
			// var height = d3.select("mapContainer").height();

			// var svg = d3.select("body").append("svg")
			//     .attr("width", width)
			//     .attr("height", height);

			// var path = d3.geo.path()
			//     .projection(projection);

			// var g = svg.append("g");

			// // load and display the World
			// d3.json("data/world-110m2.json", function(error, topology) {
			//     g.selectAll("path")
			//       .data(topojson.object(topology, topology.objects.countries)
			//           .geometries)
			//     .enter()
			//       .append("path")
			//       .attr("d", path)
			// });
		}

		$(window).resize(function() {
		    if(this.resizeTO) clearTimeout(this.resizeTO);
		    this.resizeTO = setTimeout(function() {
		        $(this).trigger('resizeEnd');
		    }, 500);
		});

		$(window).bind('resizeEnd', function() {
		    var height = $("#map-container").width()/2;
		    $("#map-container svg").css("height", height);
		    draw(height);
		});

		draw($("#map-container").width()/2);
		</script>

	</body>
</html>
